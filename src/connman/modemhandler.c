/* modemhandler.c generated by valac 0.14.2, the Vala compiler
 * generated from modemhandler.vala, do not modify */

/*
 * Copyright (C) 2011 Simon Busch <morphis@gravedo.de>
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.

 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 **/

#include <glib.h>
#include <glib-object.h>
#include <fsobasics.h>
#include <freesmartphone.h>
#include <connman/device.h>
#include <connman/network.h>
#include <connman/ipconfig.h>
#include <stdlib.h>
#include <string.h>
#include <gio/gio.h>
#include <fsoframework.h>
#include <errno.h>


#define FSO_GSM_TYPE_MODEM_HANDLER (fso_gsm_modem_handler_get_type ())
#define FSO_GSM_MODEM_HANDLER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), FSO_GSM_TYPE_MODEM_HANDLER, FsoGsmModemHandler))
#define FSO_GSM_MODEM_HANDLER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), FSO_GSM_TYPE_MODEM_HANDLER, FsoGsmModemHandlerClass))
#define FSO_GSM_IS_MODEM_HANDLER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), FSO_GSM_TYPE_MODEM_HANDLER))
#define FSO_GSM_IS_MODEM_HANDLER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), FSO_GSM_TYPE_MODEM_HANDLER))
#define FSO_GSM_MODEM_HANDLER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), FSO_GSM_TYPE_MODEM_HANDLER, FsoGsmModemHandlerClass))

typedef struct _FsoGsmModemHandler FsoGsmModemHandler;
typedef struct _FsoGsmModemHandlerClass FsoGsmModemHandlerClass;
typedef struct _FsoGsmModemHandlerPrivate FsoGsmModemHandlerPrivate;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
#define _connman_device_unref0(var) ((var == NULL) ? NULL : (var = (connman_device_unref (var), NULL)))
#define _connman_network_unref0(var) ((var == NULL) ? NULL : (var = (connman_network_unref (var), NULL)))
#define _connman_ipaddress_free0(var) ((var == NULL) ? NULL : (var = (connman_ipaddress_free (var), NULL)))
#define _g_free0(var) (var = (g_free (var), NULL))
#define _g_hash_table_unref0(var) ((var == NULL) ? NULL : (var = (g_hash_table_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))
typedef struct _FsoGsmModemHandlerCheckGprsSupportData FsoGsmModemHandlerCheckGprsSupportData;
typedef struct _FsoGsmModemHandlerCheckRegistrationData FsoGsmModemHandlerCheckRegistrationData;
typedef struct _FsoGsmModemHandlerCreateDeviceData FsoGsmModemHandlerCreateDeviceData;
#define _g_variant_unref0(var) ((var == NULL) ? NULL : (var = (g_variant_unref (var), NULL)))
typedef struct _FsoGsmModemHandlerOnModemNetworkStatusChangedData FsoGsmModemHandlerOnModemNetworkStatusChangedData;
typedef struct _FsoGsmModemHandlerOnModemDeviceStatusChangedData FsoGsmModemHandlerOnModemDeviceStatusChangedData;
typedef struct _FsoGsmModemHandlerOnGsmResourceAvailableData FsoGsmModemHandlerOnGsmResourceAvailableData;
typedef struct _FsoGsmModemHandlerInitializeData FsoGsmModemHandlerInitializeData;
typedef struct _FsoGsmModemHandlerConnectNetworkData FsoGsmModemHandlerConnectNetworkData;
typedef struct _FsoGsmModemHandlerDisconnectNetworkData FsoGsmModemHandlerDisconnectNetworkData;

struct _FsoGsmModemHandler {
	FsoFrameworkAbstractObject parent_instance;
	FsoGsmModemHandlerPrivate * priv;
};

struct _FsoGsmModemHandlerClass {
	FsoFrameworkAbstractObjectClass parent_class;
};

struct _FsoGsmModemHandlerPrivate {
	FreeSmartphoneUsage* usage;
	FreeSmartphoneGSMSIM* sim_service;
	FreeSmartphoneGSMPDP* pdp_service;
	FreeSmartphoneGSMDevice* device_service;
	FreeSmartphoneGSMNetwork* network_service;
	FreeSmartphoneDataWorld* world_service;
	struct connman_device* network_device;
	struct connman_network* network;
	struct connman_ipaddress* ipaddr;
	FreeSmartphoneGSMDeviceStatus modem_status;
	gboolean initialized;
	gboolean available;
	gboolean supports_gprs;
	gint signal_strength;
	gchar* operator_name;
	gchar* mccmnc;
};

struct _FsoGsmModemHandlerCheckGprsSupportData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	FreeSmartphoneGSMDevice* _tmp0_;
	GHashTable* _tmp1_;
	GHashTable* features;
	gconstpointer _tmp2_;
	GError* err;
	FsoFrameworkLogger* _tmp3_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerCheckRegistrationData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	FreeSmartphoneGSMDevice* _tmp0_;
	FreeSmartphoneGSMDeviceStatus _tmp1_;
	FreeSmartphoneGSMDeviceStatus device_status;
	FreeSmartphoneGSMDeviceStatus _tmp2_;
	FsoFrameworkLogger* _tmp3_;
	FsoFrameworkLogger* _tmp4_;
	struct connman_network* _tmp5_;
	FsoFrameworkLogger* _tmp6_;
	struct connman_device* _tmp7_;
	gchar* _tmp8_;
	gchar* imsi;
	const gchar* _tmp9_;
	struct connman_network* _tmp10_;
	struct connman_network* _tmp11_;
	FsoFrameworkLogger* _tmp12_;
	struct connman_ipaddress* _tmp13_;
	struct connman_network* _tmp14_;
	struct connman_network* _tmp15_;
	struct connman_network* _tmp16_;
	struct connman_network* _tmp17_;
	struct connman_network* _tmp18_;
	struct connman_network* _tmp19_;
	const gchar* _tmp20_;
	struct connman_network* _tmp21_;
	gint _tmp22_;
	struct connman_device* _tmp23_;
	struct connman_network* _tmp24_;
	FsoFrameworkLogger* _tmp25_;
	GError* err;
	FsoFrameworkLogger* _tmp26_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerCreateDeviceData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	gboolean result;
	gchar* _tmp0_;
	gchar* imsi;
	gboolean _result_;
	FreeSmartphoneGSMSIM* _tmp1_;
	GHashTable* _tmp2_;
	GHashTable* info;
	GHashTable* _tmp3_;
	gconstpointer _tmp4_;
	const gchar* _tmp5_;
	gchar* _tmp6_;
	const gchar* _tmp7_;
	gchar* _tmp8_;
	struct connman_device* _tmp9_;
	struct connman_device* _tmp10_;
	const gchar* _tmp11_;
	struct connman_device* _tmp12_;
	struct connman_device* _tmp13_;
	struct connman_device* _tmp14_;
	const gchar* _tmp15_;
	struct connman_device* _tmp16_;
	gint _tmp17_;
	GError* err;
	FsoFrameworkLogger* _tmp18_;
	GError* _tmp19_;
	const gchar* _tmp20_;
	const gchar* _tmp21_;
	gchar* _tmp22_;
	gchar* _tmp23_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerOnModemNetworkStatusChangedData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	GHashTable* status;
	GHashTable* _tmp0_;
	gconstpointer _tmp1_;
	GVariant* _tmp2_;
	GVariant* v0;
	const gchar* _tmp3_;
	GVariant* _tmp4_;
	GVariant* _tmp5_;
	const gchar* _tmp6_;
	const gchar* _tmp7_;
	gchar* _tmp8_;
	GHashTable* _tmp9_;
	gconstpointer _tmp10_;
	GVariant* _tmp11_;
	GVariant* v2;
	const gchar* _tmp12_;
	GVariant* _tmp13_;
	GVariant* _tmp14_;
	const gchar* _tmp15_;
	const gchar* _tmp16_;
	gchar* _tmp17_;
	struct connman_network* _tmp18_;
	struct connman_network* _tmp19_;
	gint _tmp20_;
	struct connman_network* _tmp21_;
	const gchar* _tmp22_;
};

struct _FsoGsmModemHandlerOnModemDeviceStatusChangedData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	FreeSmartphoneGSMDeviceStatus status;
	FsoFrameworkLogger* _tmp0_;
	FreeSmartphoneGSMDeviceStatus _tmp1_;
	GEnumValue* _tmp2_;
	gchar* _tmp3_;
	gchar* _tmp4_;
	gboolean _tmp5_;
	FreeSmartphoneGSMDeviceStatus _tmp6_;
	FreeSmartphoneGSMDeviceStatus _tmp7_;
	FreeSmartphoneGSMDeviceStatus _tmp8_;
	gboolean _tmp9_;
	FsoFrameworkLogger* _tmp10_;
	FreeSmartphoneGSMDeviceStatus _tmp11_;
	struct connman_device* _tmp12_;
	FreeSmartphoneGSMDeviceStatus _tmp13_;
};

struct _FsoGsmModemHandlerOnGsmResourceAvailableData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	FreeSmartphoneUsage* _tmp0_;
	gpointer _tmp1_;
	FreeSmartphoneGSMDevice* _tmp2_;
	gpointer _tmp3_;
	FreeSmartphoneGSMSIM* _tmp4_;
	gpointer _tmp5_;
	FreeSmartphoneGSMNetwork* _tmp6_;
	gpointer _tmp7_;
	FreeSmartphoneGSMPDP* _tmp8_;
	FreeSmartphoneDataWorld* _tmp9_;
	FreeSmartphoneDataWorld* _tmp10_;
	FreeSmartphoneGSMDevice* _tmp11_;
	FreeSmartphoneGSMNetwork* _tmp12_;
	FsoFrameworkLogger* _tmp13_;
	FreeSmartphoneGSMDevice* _tmp14_;
	FreeSmartphoneGSMDeviceStatus _tmp15_;
	FreeSmartphoneGSMDeviceStatus device_status;
	FreeSmartphoneGSMDeviceStatus _tmp16_;
	GError* err;
	FsoFrameworkLogger* _tmp17_;
	GError* _tmp18_;
	const gchar* _tmp19_;
	const gchar* _tmp20_;
	gchar* _tmp21_;
	gchar* _tmp22_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerInitializeData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	gchar** _tmp0_;
	gchar** resources;
	gint resources_length1;
	gint _resources_size_;
	FsoFrameworkLogger* _tmp1_;
	gboolean _tmp2_;
	FreeSmartphoneUsage* _tmp3_;
	FreeSmartphoneUsage* _tmp4_;
	FreeSmartphoneUsage* _tmp5_;
	FreeSmartphoneUsage* _tmp6_;
	gint _tmp7_;
	gchar** _tmp8_;
	gchar** _tmp9_;
	gint _tmp9__length1;
	gint __tmp9__size_;
	gchar** _tmp10_;
	gint _tmp10__length1;
	GError* err;
	FsoFrameworkLogger* _tmp11_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerConnectNetworkData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	gint result;
	FsoFrameworkLogger* _tmp0_;
	const gchar* _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	FsoFrameworkLogger* _tmp4_;
	FsoFrameworkLogger* _tmp5_;
	const gchar* _tmp6_;
	const gchar* _tmp7_;
	gchar* _tmp8_;
	gchar* _tmp9_;
	FreeSmartphoneDataWorld* _tmp10_;
	const gchar* _tmp11_;
	gint _tmp12_;
	FreeSmartphoneDataWorldConnectivityAccessPoint* _tmp13_;
	FreeSmartphoneDataWorldConnectivityAccessPoint* apns;
	gint apns_length1;
	gint _apns_size_;
	FreeSmartphoneDataWorldConnectivityAccessPoint* _tmp14_;
	gint _tmp14__length1;
	FsoFrameworkLogger* _tmp15_;
	FreeSmartphoneDataWorldConnectivityAccessPoint* _tmp16_;
	gint _tmp16__length1;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp17_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp18_;
	FreeSmartphoneDataWorldConnectivityAccessPoint apn;
	FsoFrameworkLogger* _tmp19_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp20_;
	const gchar* _tmp21_;
	const gchar* _tmp22_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp23_;
	const gchar* _tmp24_;
	const gchar* _tmp25_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp26_;
	const gchar* _tmp27_;
	const gchar* _tmp28_;
	gchar* _tmp29_;
	gchar* _tmp30_;
	FreeSmartphoneGSMPDP* _tmp31_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp32_;
	const gchar* _tmp33_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp34_;
	const gchar* _tmp35_;
	FreeSmartphoneDataWorldConnectivityAccessPoint _tmp36_;
	const gchar* _tmp37_;
	FreeSmartphoneGSMPDP* _tmp38_;
	GError* err;
	FsoFrameworkLogger* _tmp39_;
	GError* _tmp40_;
	const gchar* _tmp41_;
	const gchar* _tmp42_;
	gchar* _tmp43_;
	gchar* _tmp44_;
	struct connman_network* _tmp45_;
	GError * _inner_error_;
};

struct _FsoGsmModemHandlerDisconnectNetworkData {
	int _state_;
	GObject* _source_object_;
	GAsyncResult* _res_;
	GSimpleAsyncResult* _async_result;
	FsoGsmModemHandler* self;
	gint result;
	FsoFrameworkLogger* _tmp0_;
	FreeSmartphoneGSMPDP* _tmp1_;
	GError* err;
	FsoFrameworkLogger* _tmp2_;
	GError* _tmp3_;
	const gchar* _tmp4_;
	const gchar* _tmp5_;
	gchar* _tmp6_;
	gchar* _tmp7_;
	struct connman_network* _tmp8_;
	GError * _inner_error_;
};


static gpointer fso_gsm_modem_handler_parent_class = NULL;

GType fso_gsm_modem_handler_get_type (void) G_GNUC_CONST;
#define FSO_GSM_MODEM_HANDLER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), FSO_GSM_TYPE_MODEM_HANDLER, FsoGsmModemHandlerPrivate))
enum  {
	FSO_GSM_MODEM_HANDLER_DUMMY_PROPERTY
};
#define FSO_GSM_MODEM_HANDLER_DEFAUTL_IMSI "262010123456789"
static void fso_gsm_modem_handler_reset_internal_data (FsoGsmModemHandler* self);
static void fso_gsm_modem_handler_on_resource_available (FsoGsmModemHandler* self, const gchar* name, gboolean availability);
static void fso_gsm_modem_handler_on_gsm_resource_available (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void fso_gsm_modem_handler_on_gsm_resource_available_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gpointer fso_gsm_modem_handler_get_service (FsoGsmModemHandler* self, GType t_type, GBoxedCopyFunc t_dup_func, GDestroyNotify t_destroy_func, GError** error);
static void fso_gsm_modem_handler_check_gprs_support_data_free (gpointer _data);
static void fso_gsm_modem_handler_check_gprs_support (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void fso_gsm_modem_handler_check_gprs_support_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_check_gprs_support_co (FsoGsmModemHandlerCheckGprsSupportData* _data_);
static void fso_gsm_modem_handler_check_gprs_support_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void fso_gsm_modem_handler_check_registration_data_free (gpointer _data);
static void fso_gsm_modem_handler_check_registration (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void fso_gsm_modem_handler_check_registration_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_check_registration_co (FsoGsmModemHandlerCheckRegistrationData* _data_);
static void fso_gsm_modem_handler_check_registration_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void fso_gsm_modem_handler_create_device_data_free (gpointer _data);
static void fso_gsm_modem_handler_create_device (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
static gboolean fso_gsm_modem_handler_create_device_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_create_device_co (FsoGsmModemHandlerCreateDeviceData* _data_);
static void fso_gsm_modem_handler_create_device_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static const gchar* _variant_get1 (GVariant* value);
static void fso_gsm_modem_handler_on_modem_network_status_changed_data_free (gpointer _data);
static void fso_gsm_modem_handler_on_modem_network_status_changed (FsoGsmModemHandler* self, GHashTable* status, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void fso_gsm_modem_handler_on_modem_network_status_changed_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_on_modem_network_status_changed_co (FsoGsmModemHandlerOnModemNetworkStatusChangedData* _data_);
static void fso_gsm_modem_handler_on_modem_device_status_changed_data_free (gpointer _data);
static void fso_gsm_modem_handler_on_modem_device_status_changed (FsoGsmModemHandler* self, FreeSmartphoneGSMDeviceStatus status, GAsyncReadyCallback _callback_, gpointer _user_data_);
static void fso_gsm_modem_handler_on_modem_device_status_changed_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_on_modem_device_status_changed_co (FsoGsmModemHandlerOnModemDeviceStatusChangedData* _data_);
const gchar* free_smartphone_gsm_device_status_to_string (FreeSmartphoneGSMDeviceStatus self);
static void fso_gsm_modem_handler_on_gsm_resource_available_data_free (gpointer _data);
static gboolean fso_gsm_modem_handler_on_gsm_resource_available_co (FsoGsmModemHandlerOnGsmResourceAvailableData* _data_);
static void fso_gsm_modem_handler_on_gsm_resource_available_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _fso_gsm_modem_handler_on_modem_device_status_changed_free_smartphone_gsm_device_device_status (FreeSmartphoneGSMDevice* _sender, FreeSmartphoneGSMDeviceStatus status, gpointer self);
static void _fso_gsm_modem_handler_on_modem_network_status_changed_free_smartphone_gsm_network_status (FreeSmartphoneGSMNetwork* _sender, GHashTable* status, gpointer self);
FsoGsmModemHandler* fso_gsm_modem_handler_new (void);
FsoGsmModemHandler* fso_gsm_modem_handler_construct (GType object_type);
static gchar* fso_gsm_modem_handler_real_repr (FsoFrameworkAbstractObject* base);
static void fso_gsm_modem_handler_initialize_data_free (gpointer _data);
void fso_gsm_modem_handler_initialize (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
void fso_gsm_modem_handler_initialize_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_initialize_co (FsoGsmModemHandlerInitializeData* _data_);
static void _fso_gsm_modem_handler_on_resource_available_free_smartphone_usage_resource_available (FreeSmartphoneUsage* _sender, const gchar* name, gboolean availability, gpointer self);
static void fso_gsm_modem_handler_initialize_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static gboolean _vala_string_array_contains (gchar** stack, int stack_length, gchar* needle);
static void fso_gsm_modem_handler_connect_network_data_free (gpointer _data);
void fso_gsm_modem_handler_connect_network (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
gint fso_gsm_modem_handler_connect_network_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_connect_network_co (FsoGsmModemHandlerConnectNetworkData* _data_);
static void fso_gsm_modem_handler_connect_network_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
static void _vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (FreeSmartphoneDataWorldConnectivityAccessPoint* array, gint array_length);
static void fso_gsm_modem_handler_disconnect_network_data_free (gpointer _data);
void fso_gsm_modem_handler_disconnect_network (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_);
gint fso_gsm_modem_handler_disconnect_network_finish (FsoGsmModemHandler* self, GAsyncResult* _res_);
static gboolean fso_gsm_modem_handler_disconnect_network_co (FsoGsmModemHandlerDisconnectNetworkData* _data_);
static void fso_gsm_modem_handler_disconnect_network_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
void fso_gsm_modem_handler_shutdown (FsoGsmModemHandler* self);
static void fso_gsm_modem_handler_finalize (GObject* obj);
static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func);
static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func);


/**
     * Reset internal data structure
     **/
static void fso_gsm_modem_handler_reset_internal_data (FsoGsmModemHandler* self) {
	gchar* _tmp0_;
	g_return_if_fail (self != NULL);
	self->priv->available = FALSE;
	self->priv->signal_strength = 0;
	self->priv->supports_gprs = FALSE;
	_tmp0_ = g_strdup ("");
	_g_free0 (self->priv->operator_name);
	self->priv->operator_name = _tmp0_;
}


/**
     * Signal handler for Usage service. Is triggered whenever a resource changes
     * its availability.
     **/
static void fso_gsm_modem_handler_on_resource_available (FsoGsmModemHandler* self, const gchar* name, gboolean availability) {
	const gchar* _tmp0_;
	g_return_if_fail (self != NULL);
	g_return_if_fail (name != NULL);
	_tmp0_ = name;
	if (g_strcmp0 (_tmp0_, "GSM") == 0) {
		gboolean _tmp1_ = FALSE;
		gboolean _tmp2_;
		gboolean _tmp4_;
		_tmp2_ = availability;
		if (_tmp2_) {
			gboolean _tmp3_;
			_tmp3_ = self->priv->available;
			_tmp1_ = !_tmp3_;
		} else {
			_tmp1_ = FALSE;
		}
		_tmp4_ = _tmp1_;
		if (_tmp4_) {
			fso_gsm_modem_handler_on_gsm_resource_available (self, NULL, NULL);
		} else {
			self->priv->available = FALSE;
		}
	}
}


/**
     * Retrieve a dbus proxy for the supplied interface defintion from the FSO
     * GSM message bus.
     **/
static gpointer fso_gsm_modem_handler_get_service (FsoGsmModemHandler* self, GType t_type, GBoxedCopyFunc t_dup_func, GDestroyNotify t_destroy_func, GError** error) {
	gpointer result = NULL;
	gpointer _tmp0_ = NULL;
	gpointer _tmp1_;
	GError * _inner_error_ = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = g_initable_new (((GType (*) (void)) g_type_get_qdata (t_type, g_quark_from_static_string ("vala-dbus-proxy-type"))) (), NULL, &_inner_error_, "g-flags", G_DBUS_PROXY_FLAGS_NONE, "g-name", FSO_FRAMEWORK_GSM_ServiceDBusName, "g-bus-type", G_BUS_TYPE_SYSTEM, "g-object-path", FSO_FRAMEWORK_GSM_DeviceServicePath, "g-interface-name", g_type_get_qdata (t_type, g_quark_from_static_string ("vala-dbus-interface-name")), NULL);
	_tmp1_ = _tmp0_;
	if (_inner_error_ != NULL) {
		g_propagate_error (error, _inner_error_);
		return NULL;
	}
	result = _tmp1_;
	return result;
}


static void fso_gsm_modem_handler_check_gprs_support_data_free (gpointer _data) {
	FsoGsmModemHandlerCheckGprsSupportData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerCheckGprsSupportData, _data_);
}


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


static void fso_gsm_modem_handler_check_gprs_support (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerCheckGprsSupportData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerCheckGprsSupportData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_check_gprs_support);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_check_gprs_support_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_check_gprs_support_co (_data_);
}


static void fso_gsm_modem_handler_check_gprs_support_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerCheckGprsSupportData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
     * Try to find out if the modem supports gprs data connections.
     **/
static void fso_gsm_modem_handler_check_gprs_support_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerCheckGprsSupportData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_check_gprs_support_co (_data_);
}


static gboolean fso_gsm_modem_handler_check_gprs_support_co (FsoGsmModemHandlerCheckGprsSupportData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	{
		_data_->_tmp0_ = _data_->self->priv->device_service;
		_data_->_state_ = 1;
		free_smartphone_gsm_device_get_features (_data_->_tmp0_, fso_gsm_modem_handler_check_gprs_support_ready, _data_);
		return FALSE;
		_state_1:
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = free_smartphone_gsm_device_get_features_finish (_data_->_tmp0_, _data_->_res_, &_data_->_inner_error_);
		_data_->features = _data_->_tmp1_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch0_g_error;
		}
		_data_->_tmp2_ = NULL;
		_data_->_tmp2_ = g_hash_table_lookup (_data_->features, "pdp");
		_data_->self->priv->supports_gprs = ((GVariant*) _data_->_tmp2_) != NULL;
		_g_hash_table_unref0 (_data_->features);
	}
	goto __finally0;
	__catch0_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp3_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_error (_data_->_tmp3_, "Cannot check if modem supports gprs");
		_g_error_free0 (_data_->err);
	}
	__finally0:
	if (_data_->_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_check_registration_data_free (gpointer _data) {
	FsoGsmModemHandlerCheckRegistrationData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerCheckRegistrationData, _data_);
}


static void fso_gsm_modem_handler_check_registration (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerCheckRegistrationData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerCheckRegistrationData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_check_registration);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_check_registration_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_check_registration_co (_data_);
}


static void fso_gsm_modem_handler_check_registration_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerCheckRegistrationData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
     * Check modem for correct registration status
     **/
static void fso_gsm_modem_handler_check_registration_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerCheckRegistrationData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_check_registration_co (_data_);
}


static gboolean fso_gsm_modem_handler_check_registration_co (FsoGsmModemHandlerCheckRegistrationData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	{
		_data_->_tmp0_ = _data_->self->priv->device_service;
		_data_->_state_ = 1;
		free_smartphone_gsm_device_get_device_status (_data_->_tmp0_, fso_gsm_modem_handler_check_registration_ready, _data_);
		return FALSE;
		_state_1:
		_data_->_tmp1_ = 0;
		_data_->_tmp1_ = free_smartphone_gsm_device_get_device_status_finish (_data_->_tmp0_, _data_->_res_, &_data_->_inner_error_);
		_data_->device_status = _data_->_tmp1_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch1_g_error;
		}
		_data_->_tmp2_ = _data_->device_status;
		if (_data_->_tmp2_ <= FREE_SMARTPHONE_GSM_DEVICE_STATUS_ALIVE_SIM_READY) {
			_data_->_tmp3_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
			fso_framework_logger_info (_data_->_tmp3_, "Modem is not yet in ALIVE_REGISTERED state; aborting registration chec" \
"k ...");
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp4_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_debug (_data_->_tmp4_, "Modem is in ALIVE_REGISTERED state now; we can register our network de" \
"vice now");
		_data_->_tmp5_ = _data_->self->priv->network;
		if (_data_->_tmp5_ != NULL) {
			_data_->_tmp6_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
			fso_framework_logger_debug (_data_->_tmp6_, "We already have a network created for the curent device; ignoring ...");
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp7_ = _data_->self->priv->network_device;
		_data_->_tmp8_ = NULL;
		_data_->_tmp8_ = connman_device_get_ident (_data_->_tmp7_);
		_data_->imsi = _data_->_tmp8_;
		_data_->_tmp9_ = _data_->imsi;
		_data_->_tmp10_ = connman_network_create (_data_->_tmp9_, CONNMAN_NETWORK_TYPE_CELLULAR);
		_connman_network_unref0 (_data_->self->priv->network);
		_data_->self->priv->network = _data_->_tmp10_;
		_data_->_tmp11_ = _data_->self->priv->network;
		if (_data_->_tmp11_ == NULL) {
			_data_->_tmp12_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
			fso_framework_logger_error (_data_->_tmp12_, "Could not create network provided by our current device");
			_g_free0 (_data_->imsi);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp13_ = _data_->self->priv->ipaddr;
		connman_ipaddress_clear (_data_->_tmp13_);
		_data_->_tmp14_ = _data_->self->priv->network;
		connman_network_set_group (_data_->_tmp14_, "fsogsm");
		_data_->_tmp15_ = _data_->self->priv->network;
		connman_network_set_available (_data_->_tmp15_, TRUE);
		_data_->_tmp16_ = _data_->self->priv->network;
		connman_network_set_associating (_data_->_tmp16_, FALSE);
		_data_->_tmp17_ = _data_->self->priv->network;
		connman_network_set_connected (_data_->_tmp17_, FALSE);
		_data_->_tmp18_ = _data_->self->priv->network;
		connman_network_set_index (_data_->_tmp18_, -1);
		_data_->_tmp19_ = _data_->self->priv->network;
		_data_->_tmp20_ = _data_->self->priv->operator_name;
		connman_network_set_string (_data_->_tmp19_, "Operator", _data_->_tmp20_);
		_data_->_tmp21_ = _data_->self->priv->network;
		_data_->_tmp22_ = _data_->self->priv->signal_strength;
		connman_network_set_strength (_data_->_tmp21_, (guint8) _data_->_tmp22_);
		_data_->_tmp23_ = _data_->self->priv->network_device;
		_data_->_tmp24_ = _data_->self->priv->network;
		connman_device_add_network (_data_->_tmp23_, _data_->_tmp24_);
		_data_->_tmp25_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_info (_data_->_tmp25_, "Successfully provided the network to the device");
		_g_free0 (_data_->imsi);
	}
	goto __finally1;
	__catch1_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp26_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_error (_data_->_tmp26_, "Cannot check modem registration status");
		_g_error_free0 (_data_->err);
	}
	__finally1:
	if (_data_->_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_create_device_data_free (gpointer _data) {
	FsoGsmModemHandlerCreateDeviceData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerCreateDeviceData, _data_);
}


static void fso_gsm_modem_handler_create_device (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerCreateDeviceData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerCreateDeviceData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_create_device);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_create_device_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_create_device_co (_data_);
}


static gboolean fso_gsm_modem_handler_create_device_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	gboolean result;
	FsoGsmModemHandlerCreateDeviceData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
	result = _data_->result;
	return result;
}


/**
     * Create a new default device and register it to the internal connman core.
     * The device can later identified by the IMSI supplied by the modem.
     **/
static void fso_gsm_modem_handler_create_device_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerCreateDeviceData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_create_device_co (_data_);
}


static const gchar* _variant_get1 (GVariant* value) {
	return g_variant_dup_string (value, NULL);
}


static const gchar* string_to_string (const gchar* self) {
	const gchar* result = NULL;
	g_return_val_if_fail (self != NULL, NULL);
	result = self;
	return result;
}


static gboolean fso_gsm_modem_handler_create_device_co (FsoGsmModemHandlerCreateDeviceData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = g_strdup (FSO_GSM_MODEM_HANDLER_DEFAUTL_IMSI);
	_data_->imsi = _data_->_tmp0_;
	_data_->_result_ = TRUE;
	{
		_data_->_tmp1_ = _data_->self->priv->sim_service;
		_data_->_state_ = 1;
		free_smartphone_gsm_sim_get_sim_info (_data_->_tmp1_, fso_gsm_modem_handler_create_device_ready, _data_);
		return FALSE;
		_state_1:
		_data_->_tmp2_ = NULL;
		_data_->_tmp2_ = free_smartphone_gsm_sim_get_sim_info_finish (_data_->_tmp1_, _data_->_res_, &_data_->_inner_error_);
		_data_->info = _data_->_tmp2_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch2_g_error;
		}
		_data_->_tmp3_ = _data_->info;
		_data_->_tmp4_ = NULL;
		_data_->_tmp4_ = g_hash_table_lookup (_data_->_tmp3_, "imsi");
		_data_->_tmp5_ = _variant_get1 ((GVariant*) _data_->_tmp4_);
		_data_->_tmp6_ = g_strdup (_data_->_tmp5_);
		_g_free0 (_data_->imsi);
		_data_->imsi = _data_->_tmp6_;
		_data_->_tmp7_ = _data_->imsi;
		if (_data_->_tmp7_ == NULL) {
			_data_->_tmp8_ = g_strdup (FSO_GSM_MODEM_HANDLER_DEFAUTL_IMSI);
			_g_free0 (_data_->imsi);
			_data_->imsi = _data_->_tmp8_;
		}
		_data_->_tmp9_ = _data_->self->priv->network_device;
		if (_data_->_tmp9_ != NULL) {
			_data_->_tmp10_ = _data_->self->priv->network_device;
			connman_device_unregister (_data_->_tmp10_);
			_connman_device_unref0 (_data_->self->priv->network_device);
			_data_->self->priv->network_device = NULL;
		}
		_data_->_tmp11_ = _data_->imsi;
		_data_->_tmp12_ = connman_device_create (_data_->_tmp11_, CONNMAN_DEVICE_TYPE_CELLULAR);
		_connman_device_unref0 (_data_->self->priv->network_device);
		_data_->self->priv->network_device = _data_->_tmp12_;
		_data_->_tmp13_ = _data_->self->priv->network_device;
		if (_data_->_tmp13_ == NULL) {
			_data_->result = FALSE;
			_g_hash_table_unref0 (_data_->info);
			_g_free0 (_data_->imsi);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp14_ = _data_->self->priv->network_device;
		_data_->_tmp15_ = _data_->imsi;
		connman_device_set_ident (_data_->_tmp14_, _data_->_tmp15_);
		_data_->_tmp16_ = _data_->self->priv->network_device;
		_data_->_tmp17_ = 0;
		_data_->_tmp17_ = connman_device_register (_data_->_tmp16_);
		if (_data_->_tmp17_ != 0) {
			_connman_device_unref0 (_data_->self->priv->network_device);
			_data_->self->priv->network_device = NULL;
		}
		_g_hash_table_unref0 (_data_->info);
	}
	goto __finally2;
	__catch2_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp18_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp19_ = _data_->err;
		_data_->_tmp20_ = _data_->_tmp19_->message;
		_data_->_tmp21_ = NULL;
		_data_->_tmp21_ = string_to_string (_data_->_tmp20_);
		_data_->_tmp22_ = NULL;
		_data_->_tmp22_ = g_strconcat ("Can't create default network device: ", _data_->_tmp21_, NULL);
		_data_->_tmp23_ = _data_->_tmp22_;
		fso_framework_logger_error (_data_->_tmp18_, _data_->_tmp23_);
		_g_free0 (_data_->_tmp23_);
		_data_->_result_ = FALSE;
		_g_error_free0 (_data_->err);
	}
	__finally2:
	if (_data_->_inner_error_ != NULL) {
		_g_free0 (_data_->imsi);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	fso_gsm_modem_handler_check_registration (_data_->self, NULL, NULL);
	fso_gsm_modem_handler_check_gprs_support (_data_->self, NULL, NULL);
	_data_->result = _data_->_result_;
	_g_free0 (_data_->imsi);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
	_g_free0 (_data_->imsi);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_on_modem_network_status_changed_data_free (gpointer _data) {
	FsoGsmModemHandlerOnModemNetworkStatusChangedData* _data_;
	_data_ = _data;
	_g_hash_table_unref0 (_data_->status);
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerOnModemNetworkStatusChangedData, _data_);
}


static gpointer _g_hash_table_ref0 (gpointer self) {
	return self ? g_hash_table_ref (self) : NULL;
}


static void fso_gsm_modem_handler_on_modem_network_status_changed (FsoGsmModemHandler* self, GHashTable* status, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerOnModemNetworkStatusChangedData* _data_;
	FsoGsmModemHandler* _tmp0_;
	GHashTable* _tmp1_;
	GHashTable* _tmp2_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerOnModemNetworkStatusChangedData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_on_modem_network_status_changed);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_on_modem_network_status_changed_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = status;
	_tmp2_ = _g_hash_table_ref0 (_tmp1_);
	_data_->status = _tmp2_;
	fso_gsm_modem_handler_on_modem_network_status_changed_co (_data_);
}


static void fso_gsm_modem_handler_on_modem_network_status_changed_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerOnModemNetworkStatusChangedData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
     * When network status has changed extract relevant information and supply
     * it the our network object.
     **/
static gpointer _g_variant_ref0 (gpointer self) {
	return self ? g_variant_ref (self) : NULL;
}


static gboolean fso_gsm_modem_handler_on_modem_network_status_changed_co (FsoGsmModemHandlerOnModemNetworkStatusChangedData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = _data_->status;
	_data_->_tmp1_ = NULL;
	_data_->_tmp1_ = g_hash_table_lookup (_data_->_tmp0_, "provider");
	_data_->_tmp2_ = _g_variant_ref0 ((GVariant*) _data_->_tmp1_);
	_data_->v0 = _data_->_tmp2_;
	_data_->_tmp4_ = _data_->v0;
	if (_data_->_tmp4_ == NULL) {
		_data_->_tmp3_ = "unknown";
	} else {
		_data_->_tmp5_ = _data_->v0;
		_data_->_tmp6_ = NULL;
		_data_->_tmp6_ = g_variant_get_string (_data_->_tmp5_, NULL);
		_data_->_tmp3_ = _data_->_tmp6_;
	}
	_data_->_tmp7_ = _data_->_tmp3_;
	_data_->_tmp8_ = g_strdup (_data_->_tmp7_);
	_g_free0 (_data_->self->priv->operator_name);
	_data_->self->priv->operator_name = _data_->_tmp8_;
	_data_->_tmp9_ = _data_->status;
	_data_->_tmp10_ = NULL;
	_data_->_tmp10_ = g_hash_table_lookup (_data_->_tmp9_, "code");
	_data_->_tmp11_ = _g_variant_ref0 ((GVariant*) _data_->_tmp10_);
	_data_->v2 = _data_->_tmp11_;
	_data_->_tmp13_ = _data_->v2;
	if (_data_->_tmp13_ == NULL) {
		_data_->_tmp12_ = "";
	} else {
		_data_->_tmp14_ = _data_->v2;
		_data_->_tmp15_ = NULL;
		_data_->_tmp15_ = g_variant_get_string (_data_->_tmp14_, NULL);
		_data_->_tmp12_ = _data_->_tmp15_;
	}
	_data_->_tmp16_ = _data_->_tmp12_;
	_data_->_tmp17_ = g_strdup (_data_->_tmp16_);
	_g_free0 (_data_->self->priv->mccmnc);
	_data_->self->priv->mccmnc = _data_->_tmp17_;
	_data_->_tmp18_ = _data_->self->priv->network;
	if (_data_->_tmp18_ != NULL) {
		_data_->_tmp19_ = _data_->self->priv->network;
		_data_->_tmp20_ = _data_->self->priv->signal_strength;
		connman_network_set_strength (_data_->_tmp19_, (guint8) _data_->_tmp20_);
		_data_->_tmp21_ = _data_->self->priv->network;
		_data_->_tmp22_ = _data_->self->priv->operator_name;
		connman_network_set_string (_data_->_tmp21_, "Operator", _data_->_tmp22_);
	}
	_g_variant_unref0 (_data_->v2);
	_g_variant_unref0 (_data_->v0);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_on_modem_device_status_changed_data_free (gpointer _data) {
	FsoGsmModemHandlerOnModemDeviceStatusChangedData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerOnModemDeviceStatusChangedData, _data_);
}


static void fso_gsm_modem_handler_on_modem_device_status_changed (FsoGsmModemHandler* self, FreeSmartphoneGSMDeviceStatus status, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerOnModemDeviceStatusChangedData* _data_;
	FsoGsmModemHandler* _tmp0_;
	FreeSmartphoneGSMDeviceStatus _tmp1_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerOnModemDeviceStatusChangedData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_on_modem_device_status_changed);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_on_modem_device_status_changed_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	_tmp1_ = status;
	_data_->status = _tmp1_;
	fso_gsm_modem_handler_on_modem_device_status_changed_co (_data_);
}


static void fso_gsm_modem_handler_on_modem_device_status_changed_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerOnModemDeviceStatusChangedData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


/**
     * When device status has changed we have to register/remove our network
     * object from the connman core.
     **/
static gboolean fso_gsm_modem_handler_on_modem_device_status_changed_co (FsoGsmModemHandlerOnModemDeviceStatusChangedData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
	_data_->_tmp1_ = _data_->status;
	_data_->_tmp2_ = g_enum_get_value (g_type_class_ref (FREE_SMARTPHONE_GSM_TYPE_DEVICE_STATUS), _data_->_tmp1_);
	_data_->_tmp3_ = NULL;
	_data_->_tmp3_ = g_strconcat ("Got modem status ", (_data_->_tmp2_ != NULL) ? _data_->_tmp2_->value_name : NULL, NULL);
	_data_->_tmp4_ = _data_->_tmp3_;
	fso_framework_logger_debug (_data_->_tmp0_, _data_->_tmp4_);
	_g_free0 (_data_->_tmp4_);
	_data_->_tmp6_ = _data_->status;
	_data_->_tmp7_ = _data_->self->priv->modem_status;
	if (_data_->_tmp6_ < _data_->_tmp7_) {
		_data_->_tmp8_ = _data_->status;
		_data_->_tmp5_ = _data_->_tmp8_ < FREE_SMARTPHONE_GSM_DEVICE_STATUS_ALIVE_SIM_READY;
	} else {
		_data_->_tmp5_ = FALSE;
	}
	_data_->_tmp9_ = _data_->_tmp5_;
	if (_data_->_tmp9_) {
		_data_->_tmp10_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_debug (_data_->_tmp10_, "Removing network as modem is not ready anymore");
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	_data_->_tmp11_ = _data_->status;
	switch (_data_->_tmp11_) {
		case FREE_SMARTPHONE_GSM_DEVICE_STATUS_ALIVE_SIM_READY:
		{
			_data_->_tmp12_ = _data_->self->priv->network_device;
			if (_data_->_tmp12_ == NULL) {
				fso_gsm_modem_handler_create_device (_data_->self, NULL, NULL);
			}
			break;
		}
		case FREE_SMARTPHONE_GSM_DEVICE_STATUS_ALIVE_REGISTERED:
		{
			fso_gsm_modem_handler_check_registration (_data_->self, NULL, NULL);
			break;
		}
		default:
		break;
	}
	_data_->_tmp13_ = _data_->status;
	_data_->self->priv->modem_status = _data_->_tmp13_;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_on_gsm_resource_available_data_free (gpointer _data) {
	FsoGsmModemHandlerOnGsmResourceAvailableData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerOnGsmResourceAvailableData, _data_);
}


static void fso_gsm_modem_handler_on_gsm_resource_available (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerOnGsmResourceAvailableData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerOnGsmResourceAvailableData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_on_gsm_resource_available);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_on_gsm_resource_available_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_on_gsm_resource_available_co (_data_);
}


static void fso_gsm_modem_handler_on_gsm_resource_available_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerOnGsmResourceAvailableData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void fso_gsm_modem_handler_on_gsm_resource_available_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerOnGsmResourceAvailableData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_on_gsm_resource_available_co (_data_);
}


static void _fso_gsm_modem_handler_on_modem_device_status_changed_free_smartphone_gsm_device_device_status (FreeSmartphoneGSMDevice* _sender, FreeSmartphoneGSMDeviceStatus status, gpointer self) {
	fso_gsm_modem_handler_on_modem_device_status_changed (self, status, NULL, NULL);
}


static void _fso_gsm_modem_handler_on_modem_network_status_changed_free_smartphone_gsm_network_status (FreeSmartphoneGSMNetwork* _sender, GHashTable* status, gpointer self) {
	fso_gsm_modem_handler_on_modem_network_status_changed (self, status, NULL, NULL);
}


static gboolean fso_gsm_modem_handler_on_gsm_resource_available_co (FsoGsmModemHandlerOnGsmResourceAvailableData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	{
		_data_->_tmp0_ = _data_->self->priv->usage;
		_data_->_state_ = 1;
		free_smartphone_usage_request_resource (_data_->_tmp0_, "GSM", fso_gsm_modem_handler_on_gsm_resource_available_ready, _data_);
		return FALSE;
		_state_1:
		free_smartphone_usage_request_resource_finish (_data_->_tmp0_, _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_data_->self->priv->available = TRUE;
		_data_->_tmp1_ = NULL;
		_data_->_tmp1_ = fso_gsm_modem_handler_get_service (_data_->self, FREE_SMARTPHONE_GSM_TYPE_DEVICE, (GBoxedCopyFunc) g_object_ref, g_object_unref, &_data_->_inner_error_);
		_data_->_tmp2_ = (FreeSmartphoneGSMDevice*) _data_->_tmp1_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_g_object_unref0 (_data_->self->priv->device_service);
		_data_->self->priv->device_service = _data_->_tmp2_;
		_data_->_tmp3_ = NULL;
		_data_->_tmp3_ = fso_gsm_modem_handler_get_service (_data_->self, FREE_SMARTPHONE_GSM_TYPE_SIM, (GBoxedCopyFunc) g_object_ref, g_object_unref, &_data_->_inner_error_);
		_data_->_tmp4_ = (FreeSmartphoneGSMSIM*) _data_->_tmp3_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_g_object_unref0 (_data_->self->priv->sim_service);
		_data_->self->priv->sim_service = _data_->_tmp4_;
		_data_->_tmp5_ = NULL;
		_data_->_tmp5_ = fso_gsm_modem_handler_get_service (_data_->self, FREE_SMARTPHONE_GSM_TYPE_NETWORK, (GBoxedCopyFunc) g_object_ref, g_object_unref, &_data_->_inner_error_);
		_data_->_tmp6_ = (FreeSmartphoneGSMNetwork*) _data_->_tmp5_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_g_object_unref0 (_data_->self->priv->network_service);
		_data_->self->priv->network_service = _data_->_tmp6_;
		_data_->_tmp7_ = NULL;
		_data_->_tmp7_ = fso_gsm_modem_handler_get_service (_data_->self, FREE_SMARTPHONE_GSM_TYPE_PDP, (GBoxedCopyFunc) g_object_ref, g_object_unref, &_data_->_inner_error_);
		_data_->_tmp8_ = (FreeSmartphoneGSMPDP*) _data_->_tmp7_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_g_object_unref0 (_data_->self->priv->pdp_service);
		_data_->self->priv->pdp_service = _data_->_tmp8_;
		_data_->_tmp9_ = NULL;
		_data_->_tmp9_ = g_initable_new (FREE_SMARTPHONE_DATA_TYPE_WORLD_PROXY, NULL, &_data_->_inner_error_, "g-flags", G_DBUS_PROXY_FLAGS_NONE, "g-name", FSO_FRAMEWORK_DATA_ServiceDBusName, "g-bus-type", G_BUS_TYPE_SYSTEM, "g-object-path", FSO_FRAMEWORK_DATA_WorldServicePath, "g-interface-name", "org.freesmartphone.Data.World", NULL);
		_data_->_tmp10_ = (FreeSmartphoneDataWorld*) _data_->_tmp9_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_g_object_unref0 (_data_->self->priv->world_service);
		_data_->self->priv->world_service = _data_->_tmp10_;
		_data_->_tmp11_ = _data_->self->priv->device_service;
		g_signal_connect_object (_data_->_tmp11_, "device-status", (GCallback) _fso_gsm_modem_handler_on_modem_device_status_changed_free_smartphone_gsm_device_device_status, _data_->self, 0);
		_data_->_tmp12_ = _data_->self->priv->network_service;
		g_signal_connect_object (_data_->_tmp12_, "status", (GCallback) _fso_gsm_modem_handler_on_modem_network_status_changed_free_smartphone_gsm_network_status, _data_->self, 0);
		_data_->_tmp13_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_info (_data_->_tmp13_, "Successfully registered with GSM resource");
		_data_->_tmp14_ = _data_->self->priv->device_service;
		_data_->_state_ = 2;
		free_smartphone_gsm_device_get_device_status (_data_->_tmp14_, fso_gsm_modem_handler_on_gsm_resource_available_ready, _data_);
		return FALSE;
		_state_2:
		_data_->_tmp15_ = 0;
		_data_->_tmp15_ = free_smartphone_gsm_device_get_device_status_finish (_data_->_tmp14_, _data_->_res_, &_data_->_inner_error_);
		_data_->device_status = _data_->_tmp15_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_data_->_tmp16_ = _data_->device_status;
		if (_data_->_tmp16_ >= FREE_SMARTPHONE_GSM_DEVICE_STATUS_ALIVE_SIM_READY) {
			fso_gsm_modem_handler_create_device (_data_->self, NULL, NULL);
		}
	}
	goto __finally3;
	__catch3_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp17_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp18_ = _data_->err;
		_data_->_tmp19_ = _data_->_tmp18_->message;
		_data_->_tmp20_ = NULL;
		_data_->_tmp20_ = string_to_string (_data_->_tmp19_);
		_data_->_tmp21_ = NULL;
		_data_->_tmp21_ = g_strconcat ("Can't setup for using GSM resource: ", _data_->_tmp20_, NULL);
		_data_->_tmp22_ = _data_->_tmp21_;
		fso_framework_logger_error (_data_->_tmp17_, _data_->_tmp22_);
		_g_free0 (_data_->_tmp22_);
		_g_error_free0 (_data_->err);
	}
	__finally3:
	if (_data_->_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


FsoGsmModemHandler* fso_gsm_modem_handler_construct (GType object_type) {
	FsoGsmModemHandler * self = NULL;
	self = (FsoGsmModemHandler*) fso_framework_abstract_object_construct (object_type);
	self->priv->initialized = FALSE;
	return self;
}


FsoGsmModemHandler* fso_gsm_modem_handler_new (void) {
	return fso_gsm_modem_handler_construct (FSO_GSM_TYPE_MODEM_HANDLER);
}


static gchar* fso_gsm_modem_handler_real_repr (FsoFrameworkAbstractObject* base) {
	FsoGsmModemHandler * self;
	gchar* result = NULL;
	gchar* _tmp0_;
	self = (FsoGsmModemHandler*) base;
	_tmp0_ = g_strdup ("<>");
	result = _tmp0_;
	return result;
}


static void fso_gsm_modem_handler_initialize_data_free (gpointer _data) {
	FsoGsmModemHandlerInitializeData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerInitializeData, _data_);
}


void fso_gsm_modem_handler_initialize (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerInitializeData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerInitializeData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_initialize);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_initialize_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_initialize_co (_data_);
}


void fso_gsm_modem_handler_initialize_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	FsoGsmModemHandlerInitializeData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
}


static void _fso_gsm_modem_handler_on_resource_available_free_smartphone_usage_resource_available (FreeSmartphoneUsage* _sender, const gchar* name, gboolean availability, gpointer self) {
	fso_gsm_modem_handler_on_resource_available (self, name, availability);
}


static void fso_gsm_modem_handler_initialize_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerInitializeData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_initialize_co (_data_);
}


static gboolean _vala_string_array_contains (gchar** stack, int stack_length, gchar* needle) {
	int i;
	for (i = 0; i < stack_length; i++) {
		if (g_strcmp0 (stack[i], needle) == 0) {
			return TRUE;
		}
	}
	return FALSE;
}


static gboolean fso_gsm_modem_handler_initialize_co (FsoGsmModemHandlerInitializeData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = NULL;
	_data_->_tmp0_ = g_new0 (gchar*, 0 + 1);
	_data_->resources = _data_->_tmp0_;
	_data_->resources_length1 = 0;
	_data_->_resources_size_ = _data_->resources_length1;
	_data_->_tmp1_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
	fso_framework_logger_info (_data_->_tmp1_, "Initializing ...");
	_data_->_tmp2_ = _data_->self->priv->initialized;
	if (_data_->_tmp2_) {
		_data_->resources = (_vala_array_free (_data_->resources, _data_->resources_length1, (GDestroyNotify) g_free), NULL);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	fso_gsm_modem_handler_reset_internal_data (_data_->self);
	{
		_data_->_tmp3_ = NULL;
		_data_->_tmp3_ = g_initable_new (FREE_SMARTPHONE_TYPE_USAGE_PROXY, NULL, &_data_->_inner_error_, "g-flags", G_DBUS_PROXY_FLAGS_NONE, "g-name", FSO_FRAMEWORK_USAGE_ServiceDBusName, "g-bus-type", G_BUS_TYPE_SYSTEM, "g-object-path", FSO_FRAMEWORK_USAGE_ServicePathPrefix, "g-interface-name", "org.freesmartphone.Usage", NULL);
		_data_->_tmp4_ = (FreeSmartphoneUsage*) _data_->_tmp3_;
		if (_data_->_inner_error_ != NULL) {
			goto __catch4_g_error;
		}
		_g_object_unref0 (_data_->self->priv->usage);
		_data_->self->priv->usage = _data_->_tmp4_;
		_data_->_tmp5_ = _data_->self->priv->usage;
		g_signal_connect_object (_data_->_tmp5_, "resource-available", (GCallback) _fso_gsm_modem_handler_on_resource_available_free_smartphone_usage_resource_available, _data_->self, 0);
		_data_->_tmp6_ = _data_->self->priv->usage;
		_data_->_tmp7_ = 0;
		_data_->_state_ = 1;
		free_smartphone_usage_list_resources (_data_->_tmp6_, fso_gsm_modem_handler_initialize_ready, _data_);
		return FALSE;
		_state_1:
		_data_->_tmp8_ = NULL;
		_data_->_tmp8_ = free_smartphone_usage_list_resources_finish (_data_->_tmp6_, _data_->_res_, &_data_->_tmp7_, &_data_->_inner_error_);
		_data_->_tmp9_ = _data_->_tmp8_;
		_data_->_tmp9__length1 = _data_->_tmp7_;
		_data_->__tmp9__size_ = _data_->_tmp9__length1;
		if (_data_->_inner_error_ != NULL) {
			goto __catch4_g_error;
		}
		_data_->resources = (_vala_array_free (_data_->resources, _data_->resources_length1, (GDestroyNotify) g_free), NULL);
		_data_->resources = _data_->_tmp9_;
		_data_->resources_length1 = _data_->_tmp9__length1;
		_data_->_resources_size_ = _data_->resources_length1;
		_data_->_tmp10_ = _data_->resources;
		_data_->_tmp10__length1 = _data_->resources_length1;
		if (_vala_string_array_contains (_data_->_tmp10_, _data_->_tmp10__length1, "GSM")) {
			fso_gsm_modem_handler_on_gsm_resource_available (_data_->self, NULL, NULL);
		}
	}
	goto __finally4;
	__catch4_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp11_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_error (_data_->_tmp11_, "Can't register on usage service for listing to new resources");
		_g_error_free0 (_data_->err);
	}
	__finally4:
	if (_data_->_inner_error_ != NULL) {
		_data_->resources = (_vala_array_free (_data_->resources, _data_->resources_length1, (GDestroyNotify) g_free), NULL);
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	_data_->self->priv->initialized = TRUE;
	_data_->resources = (_vala_array_free (_data_->resources, _data_->resources_length1, (GDestroyNotify) g_free), NULL);
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_connect_network_data_free (gpointer _data) {
	FsoGsmModemHandlerConnectNetworkData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerConnectNetworkData, _data_);
}


void fso_gsm_modem_handler_connect_network (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerConnectNetworkData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerConnectNetworkData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_connect_network);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_connect_network_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_connect_network_co (_data_);
}


gint fso_gsm_modem_handler_connect_network_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	gint result;
	FsoGsmModemHandlerConnectNetworkData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
	result = _data_->result;
	return result;
}


/**
     * Establish PDP connection with registered network
     **/
static void fso_gsm_modem_handler_connect_network_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerConnectNetworkData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_connect_network_co (_data_);
}


static void _vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (FreeSmartphoneDataWorldConnectivityAccessPoint* array, gint array_length) {
	if (array != NULL) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			free_smartphone_data_world_connectivity_access_point_destroy (&array[i]);
		}
	}
	g_free (array);
}


static gboolean fso_gsm_modem_handler_connect_network_co (FsoGsmModemHandlerConnectNetworkData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		case 2:
		goto _state_2;
		case 3:
		goto _state_3;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
	fso_framework_logger_debug (_data_->_tmp0_, "Establishing GSM PDP connection ...");
	_data_->_tmp1_ = _data_->self->priv->mccmnc;
	_data_->_tmp2_ = strlen (_data_->_tmp1_);
	_data_->_tmp3_ = _data_->_tmp2_;
	if (_data_->_tmp3_ == 0) {
		_data_->_tmp4_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		fso_framework_logger_error (_data_->_tmp4_, "We don't have mcc and mnc to retrieve correct APN for PDP connection");
		_data_->result = -EINVAL;
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	{
		_data_->_tmp5_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp6_ = _data_->self->priv->mccmnc;
		_data_->_tmp7_ = NULL;
		_data_->_tmp7_ = string_to_string (_data_->_tmp6_);
		_data_->_tmp8_ = NULL;
		_data_->_tmp8_ = g_strconcat ("mccmnc = ", _data_->_tmp7_, NULL);
		_data_->_tmp9_ = _data_->_tmp8_;
		fso_framework_logger_debug (_data_->_tmp5_, _data_->_tmp9_);
		_g_free0 (_data_->_tmp9_);
		_data_->_tmp10_ = _data_->self->priv->world_service;
		_data_->_tmp11_ = _data_->self->priv->mccmnc;
		_data_->_tmp12_ = 0;
		_data_->_state_ = 1;
		free_smartphone_data_world_get_apns_for_mcc_mnc (_data_->_tmp10_, _data_->_tmp11_, fso_gsm_modem_handler_connect_network_ready, _data_);
		return FALSE;
		_state_1:
		_data_->_tmp13_ = NULL;
		_data_->_tmp13_ = free_smartphone_data_world_get_apns_for_mcc_mnc_finish (_data_->_tmp10_, _data_->_res_, &_data_->_tmp12_, &_data_->_inner_error_);
		_data_->apns = _data_->_tmp13_;
		_data_->apns_length1 = _data_->_tmp12_;
		_data_->_apns_size_ = _data_->apns_length1;
		if (_data_->_inner_error_ != NULL) {
			goto __catch5_g_error;
		}
		_data_->_tmp14_ = _data_->apns;
		_data_->_tmp14__length1 = _data_->apns_length1;
		if (_data_->_tmp14__length1 == 0) {
			_data_->_tmp15_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
			fso_framework_logger_error (_data_->_tmp15_, "Invalid mcc and mnc wihtout context information!");
			_data_->result = -EINVAL;
			_data_->apns = (_vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (_data_->apns, _data_->apns_length1), NULL);
			if (_data_->_state_ == 0) {
				g_simple_async_result_complete_in_idle (_data_->_async_result);
			} else {
				g_simple_async_result_complete (_data_->_async_result);
			}
			g_object_unref (_data_->_async_result);
			return FALSE;
		}
		_data_->_tmp16_ = _data_->apns;
		_data_->_tmp16__length1 = _data_->apns_length1;
		_data_->_tmp17_ = _data_->_tmp16_[0];
		memset (&_data_->_tmp18_, 0, sizeof (FreeSmartphoneDataWorldConnectivityAccessPoint));
		free_smartphone_data_world_connectivity_access_point_copy (&_data_->_tmp17_, &_data_->_tmp18_);
		_data_->apn = _data_->_tmp18_;
		_data_->_tmp19_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp20_ = _data_->apn;
		_data_->_tmp21_ = _data_->_tmp20_.apn;
		_data_->_tmp22_ = NULL;
		_data_->_tmp22_ = string_to_string (_data_->_tmp21_);
		_data_->_tmp23_ = _data_->apn;
		_data_->_tmp24_ = _data_->_tmp23_.username;
		_data_->_tmp25_ = NULL;
		_data_->_tmp25_ = string_to_string (_data_->_tmp24_);
		_data_->_tmp26_ = _data_->apn;
		_data_->_tmp27_ = _data_->_tmp26_.password;
		_data_->_tmp28_ = NULL;
		_data_->_tmp28_ = string_to_string (_data_->_tmp27_);
		_data_->_tmp29_ = NULL;
		_data_->_tmp29_ = g_strconcat ("Using apn = \"", _data_->_tmp22_, "\", username = \"", _data_->_tmp25_, "\", password = \"", _data_->_tmp28_, "\"", NULL);
		_data_->_tmp30_ = _data_->_tmp29_;
		fso_framework_logger_debug (_data_->_tmp19_, _data_->_tmp30_);
		_g_free0 (_data_->_tmp30_);
		_data_->_tmp31_ = _data_->self->priv->pdp_service;
		_data_->_tmp32_ = _data_->apn;
		_data_->_tmp33_ = _data_->_tmp32_.apn;
		_data_->_tmp34_ = _data_->apn;
		_data_->_tmp35_ = _data_->_tmp34_.username;
		_data_->_tmp36_ = _data_->apn;
		_data_->_tmp37_ = _data_->_tmp36_.password;
		_data_->_state_ = 2;
		free_smartphone_gsm_pdp_set_credentials (_data_->_tmp31_, _data_->_tmp33_, _data_->_tmp35_, _data_->_tmp37_, fso_gsm_modem_handler_connect_network_ready, _data_);
		return FALSE;
		_state_2:
		free_smartphone_gsm_pdp_set_credentials_finish (_data_->_tmp31_, _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			free_smartphone_data_world_connectivity_access_point_destroy (&_data_->apn);
			_data_->apns = (_vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (_data_->apns, _data_->apns_length1), NULL);
			goto __catch5_g_error;
		}
		_data_->_tmp38_ = _data_->self->priv->pdp_service;
		_data_->_state_ = 3;
		free_smartphone_gsm_pdp_activate_context (_data_->_tmp38_, fso_gsm_modem_handler_connect_network_ready, _data_);
		return FALSE;
		_state_3:
		free_smartphone_gsm_pdp_activate_context_finish (_data_->_tmp38_, _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			free_smartphone_data_world_connectivity_access_point_destroy (&_data_->apn);
			_data_->apns = (_vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (_data_->apns, _data_->apns_length1), NULL);
			goto __catch5_g_error;
		}
		free_smartphone_data_world_connectivity_access_point_destroy (&_data_->apn);
		_data_->apns = (_vala_FreeSmartphoneDataWorldConnectivityAccessPoint_array_free (_data_->apns, _data_->apns_length1), NULL);
	}
	goto __finally5;
	__catch5_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp39_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp40_ = _data_->err;
		_data_->_tmp41_ = _data_->_tmp40_->message;
		_data_->_tmp42_ = NULL;
		_data_->_tmp42_ = string_to_string (_data_->_tmp41_);
		_data_->_tmp43_ = NULL;
		_data_->_tmp43_ = g_strconcat ("Failed to activate PDP connection: ", _data_->_tmp42_, NULL);
		_data_->_tmp44_ = _data_->_tmp43_;
		fso_framework_logger_error (_data_->_tmp39_, _data_->_tmp44_);
		_g_free0 (_data_->_tmp44_);
		_data_->result = -1;
		_g_error_free0 (_data_->err);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	__finally5:
	if (_data_->_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	_data_->_tmp45_ = _data_->self->priv->network;
	connman_network_set_connected (_data_->_tmp45_, TRUE);
	_data_->result = 0;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


static void fso_gsm_modem_handler_disconnect_network_data_free (gpointer _data) {
	FsoGsmModemHandlerDisconnectNetworkData* _data_;
	_data_ = _data;
	_g_object_unref0 (_data_->self);
	g_slice_free (FsoGsmModemHandlerDisconnectNetworkData, _data_);
}


void fso_gsm_modem_handler_disconnect_network (FsoGsmModemHandler* self, GAsyncReadyCallback _callback_, gpointer _user_data_) {
	FsoGsmModemHandlerDisconnectNetworkData* _data_;
	FsoGsmModemHandler* _tmp0_;
	_data_ = g_slice_new0 (FsoGsmModemHandlerDisconnectNetworkData);
	_data_->_async_result = g_simple_async_result_new (G_OBJECT (self), _callback_, _user_data_, fso_gsm_modem_handler_disconnect_network);
	g_simple_async_result_set_op_res_gpointer (_data_->_async_result, _data_, fso_gsm_modem_handler_disconnect_network_data_free);
	_tmp0_ = _g_object_ref0 (self);
	_data_->self = _tmp0_;
	fso_gsm_modem_handler_disconnect_network_co (_data_);
}


gint fso_gsm_modem_handler_disconnect_network_finish (FsoGsmModemHandler* self, GAsyncResult* _res_) {
	gint result;
	FsoGsmModemHandlerDisconnectNetworkData* _data_;
	_data_ = g_simple_async_result_get_op_res_gpointer (G_SIMPLE_ASYNC_RESULT (_res_));
	result = _data_->result;
	return result;
}


/**
     * Realse current active PDP connection
     **/
static void fso_gsm_modem_handler_disconnect_network_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_) {
	FsoGsmModemHandlerDisconnectNetworkData* _data_;
	_data_ = _user_data_;
	_data_->_source_object_ = source_object;
	_data_->_res_ = _res_;
	fso_gsm_modem_handler_disconnect_network_co (_data_);
}


static gboolean fso_gsm_modem_handler_disconnect_network_co (FsoGsmModemHandlerDisconnectNetworkData* _data_) {
	switch (_data_->_state_) {
		case 0:
		goto _state_0;
		case 1:
		goto _state_1;
		default:
		g_assert_not_reached ();
	}
	_state_0:
	_data_->_tmp0_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
	fso_framework_logger_debug (_data_->_tmp0_, "Releasing GSM PDP connection ...");
	{
		_data_->_tmp1_ = _data_->self->priv->pdp_service;
		_data_->_state_ = 1;
		free_smartphone_gsm_pdp_deactivate_context (_data_->_tmp1_, fso_gsm_modem_handler_disconnect_network_ready, _data_);
		return FALSE;
		_state_1:
		free_smartphone_gsm_pdp_deactivate_context_finish (_data_->_tmp1_, _data_->_res_, &_data_->_inner_error_);
		if (_data_->_inner_error_ != NULL) {
			goto __catch6_g_error;
		}
	}
	goto __finally6;
	__catch6_g_error:
	{
		_data_->err = _data_->_inner_error_;
		_data_->_inner_error_ = NULL;
		_data_->_tmp2_ = ((FsoFrameworkAbstractObject*) _data_->self)->logger;
		_data_->_tmp3_ = _data_->err;
		_data_->_tmp4_ = _data_->_tmp3_->message;
		_data_->_tmp5_ = NULL;
		_data_->_tmp5_ = string_to_string (_data_->_tmp4_);
		_data_->_tmp6_ = NULL;
		_data_->_tmp6_ = g_strconcat ("Failed to deactivate PDP connection: ", _data_->_tmp5_, NULL);
		_data_->_tmp7_ = _data_->_tmp6_;
		fso_framework_logger_error (_data_->_tmp2_, _data_->_tmp7_);
		_g_free0 (_data_->_tmp7_);
		_data_->result = -1;
		_g_error_free0 (_data_->err);
		if (_data_->_state_ == 0) {
			g_simple_async_result_complete_in_idle (_data_->_async_result);
		} else {
			g_simple_async_result_complete (_data_->_async_result);
		}
		g_object_unref (_data_->_async_result);
		return FALSE;
	}
	__finally6:
	if (_data_->_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _data_->_inner_error_->message, g_quark_to_string (_data_->_inner_error_->domain), _data_->_inner_error_->code);
		g_clear_error (&_data_->_inner_error_);
		return FALSE;
	}
	_data_->_tmp8_ = _data_->self->priv->network;
	connman_network_set_connected (_data_->_tmp8_, FALSE);
	_data_->result = 0;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
	if (_data_->_state_ == 0) {
		g_simple_async_result_complete_in_idle (_data_->_async_result);
	} else {
		g_simple_async_result_complete (_data_->_async_result);
	}
	g_object_unref (_data_->_async_result);
	return FALSE;
}


void fso_gsm_modem_handler_shutdown (FsoGsmModemHandler* self) {
	FsoFrameworkLogger* _tmp0_;
	struct connman_device* _tmp1_;
	g_return_if_fail (self != NULL);
	_tmp0_ = ((FsoFrameworkAbstractObject*) self)->logger;
	fso_framework_logger_info (_tmp0_, "Shuting down ...");
	_tmp1_ = self->priv->network_device;
	if (_tmp1_ != NULL) {
		struct connman_device* _tmp2_;
		struct connman_device* _tmp3_;
		_tmp2_ = self->priv->network_device;
		connman_device_remove_all_networks (_tmp2_);
		_tmp3_ = self->priv->network_device;
		connman_device_unregister (_tmp3_);
		_connman_device_unref0 (self->priv->network_device);
		self->priv->network_device = NULL;
		_connman_network_unref0 (self->priv->network);
		self->priv->network = NULL;
	}
}


static void fso_gsm_modem_handler_class_init (FsoGsmModemHandlerClass * klass) {
	fso_gsm_modem_handler_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (FsoGsmModemHandlerPrivate));
	FSO_FRAMEWORK_ABSTRACT_OBJECT_CLASS (klass)->repr = fso_gsm_modem_handler_real_repr;
	G_OBJECT_CLASS (klass)->finalize = fso_gsm_modem_handler_finalize;
}


static void fso_gsm_modem_handler_instance_init (FsoGsmModemHandler * self) {
	self->priv = FSO_GSM_MODEM_HANDLER_GET_PRIVATE (self);
}


static void fso_gsm_modem_handler_finalize (GObject* obj) {
	FsoGsmModemHandler * self;
	self = FSO_GSM_MODEM_HANDLER (obj);
	_g_object_unref0 (self->priv->usage);
	_g_object_unref0 (self->priv->sim_service);
	_g_object_unref0 (self->priv->pdp_service);
	_g_object_unref0 (self->priv->device_service);
	_g_object_unref0 (self->priv->network_service);
	_g_object_unref0 (self->priv->world_service);
	_connman_device_unref0 (self->priv->network_device);
	_connman_network_unref0 (self->priv->network);
	_connman_ipaddress_free0 (self->priv->ipaddr);
	_g_free0 (self->priv->operator_name);
	_g_free0 (self->priv->mccmnc);
	G_OBJECT_CLASS (fso_gsm_modem_handler_parent_class)->finalize (obj);
}


GType fso_gsm_modem_handler_get_type (void) {
	static volatile gsize fso_gsm_modem_handler_type_id__volatile = 0;
	if (g_once_init_enter (&fso_gsm_modem_handler_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (FsoGsmModemHandlerClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) fso_gsm_modem_handler_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (FsoGsmModemHandler), 0, (GInstanceInitFunc) fso_gsm_modem_handler_instance_init, NULL };
		GType fso_gsm_modem_handler_type_id;
		fso_gsm_modem_handler_type_id = g_type_register_static (FSO_FRAMEWORK_TYPE_ABSTRACT_OBJECT, "FsoGsmModemHandler", &g_define_type_info, 0);
		g_once_init_leave (&fso_gsm_modem_handler_type_id__volatile, fso_gsm_modem_handler_type_id);
	}
	return fso_gsm_modem_handler_type_id__volatile;
}


static void _vala_array_destroy (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	if ((array != NULL) && (destroy_func != NULL)) {
		int i;
		for (i = 0; i < array_length; i = i + 1) {
			if (((gpointer*) array)[i] != NULL) {
				destroy_func (((gpointer*) array)[i]);
			}
		}
	}
}


static void _vala_array_free (gpointer array, gint array_length, GDestroyNotify destroy_func) {
	_vala_array_destroy (array, array_length, destroy_func);
	g_free (array);
}



